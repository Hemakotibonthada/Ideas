datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// â”€â”€â”€ Enums â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

enum WaterSource {
  TAP
  BOTTLE
  FILTERED
  SPARKLING
}

enum Unit {
  ML
  OZ
  CUP
  LITER
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum Role {
  USER
  ADMIN
}

// â”€â”€â”€ Models â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  avatar    String?
  weight    Float?   // kg, used for goal calculation
  age       Int?
  role      Role     @default(USER)
  timezone  String   @default("UTC")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  waterLogs  WaterLog[]
  dailyGoals DailyGoal[]
  reminders  Reminder[]
  streaks    HydrationStreak[]

  @@index([email])
}

model WaterLog {
  id        String      @id @default(cuid())
  amount    Float       // quantity in specified unit
  unit      Unit        @default(ML)
  amountMl  Float       // normalized to ml for aggregation
  source    WaterSource @default(TAP)
  timestamp DateTime    @default(now())
  note      String?
  createdAt DateTime    @default(now())

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([timestamp])
  @@index([userId, timestamp])
}

model DailyGoal {
  id       String   @id @default(cuid())
  target   Float    // target in ml
  achieved Float    @default(0) // achieved in ml
  met      Boolean  @default(false)
  date     DateTime @db.Date
  note     String?

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

model Reminder {
  id        String      @id @default(cuid())
  time      String      // HH:mm format
  enabled   Boolean     @default(true)
  days      DayOfWeek[] // which days this reminder is active
  message   String?     @default("Time to drink water! ðŸ’§")
  sound     Boolean     @default(true)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([enabled])
}

model HydrationStreak {
  id           String    @id @default(cuid())
  startDate    DateTime  @db.Date
  endDate      DateTime? @db.Date
  currentDays  Int       @default(1)
  longestDays  Int       @default(1)
  active       Boolean   @default(true)
  lastLogDate  DateTime  @db.Date
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([active])
  @@index([userId, active])
}
