datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ── Enums ──────────────────────────────────────────────

enum Difficulty {
  NEW
  EASY
  MEDIUM
  HARD
  VERY_HARD
}

// ── Models ─────────────────────────────────────────────

model User {
  id                 String           @id @default(cuid())
  email              String           @unique
  name               String
  studyGoalMinsPerDay Int             @default(60)
  currentStreak      Int              @default(0)
  totalStudyHours    Float            @default(0)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt

  subjects           Subject[]
  studySessions      StudySession[]
  notes              Note[]
  studyPlans         StudyPlan[]
  achievements       Achievement[]
}

model Subject {
  id            String         @id @default(cuid())
  userId        String
  name          String
  color         String
  icon          String?
  totalCards    Int            @default(0)
  masteredCards Int            @default(0)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  flashcards    Flashcard[]
  studySessions StudySession[]
  notes         Note[]
  quizzes       GeneratedQuiz[]

  @@index([userId])
}

model Flashcard {
  id          String     @id @default(cuid())
  subjectId   String
  front       String
  back        String
  imageUrl    String?
  difficulty  Difficulty @default(NEW)
  nextReviewAt DateTime  @default(now())
  easeFactor  Float      @default(2.5)
  interval    Int        @default(0)
  reviewCount Int        @default(0)
  correctCount Int       @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  subject     Subject    @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@index([subjectId])
  @@index([nextReviewAt])
}

model StudySession {
  id            String   @id @default(cuid())
  userId        String
  subjectId     String
  startedAt     DateTime @default(now())
  endedAt       DateTime?
  cardsReviewed Int      @default(0)
  correctCount  Int      @default(0)
  xpEarned      Int      @default(0)

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  subject       Subject  @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([subjectId])
}

model Note {
  id        String   @id @default(cuid())
  userId    String
  subjectId String
  title     String
  content   String
  sourceUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  subject   Subject  @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([subjectId])
}

model GeneratedQuiz {
  id             String    @id @default(cuid())
  subjectId      String
  questions      Json
  score          Int?
  totalQuestions Int
  completedAt    DateTime?
  createdAt      DateTime  @default(now())

  subject        Subject   @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@index([subjectId])
}

model StudyPlan {
  id            String   @id @default(cuid())
  userId        String
  examDate      DateTime
  subjects      Json
  dailyGoalMins Int      @default(60)
  progress      Float    @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Achievement {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String
  icon        String
  xp          Int      @default(0)
  unlockedAt  DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}
