datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum FootprintCategory {
  TRANSPORT
  FOOD
  ENERGY
  SHOPPING
  WASTE
  TRAVEL
  DIGITAL
}

enum Difficulty {
  EASY
  MODERATE
  HARD
}

enum PostType {
  TIP
  ACHIEVEMENT
  QUESTION
}

model User {
  id                   String           @id @default(cuid())
  email                String           @unique
  name                 String
  location             String?
  householdSize        Int              @default(1)
  monthlyFootprintKg   Float            @default(0)
  reductionGoalPercent Float?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  footprintEntries     FootprintEntry[]
  userChallenges       UserChallenge[]
  monthlyReports       MonthlyReport[]
  achievements         Achievement[]
  communityPosts       CommunityBoard[]
}

model FootprintEntry {
  id       String            @id @default(cuid())
  user     User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId   String
  category FootprintCategory
  activity String
  amount   Float
  unit     String
  co2Kg    Float
  date     DateTime          @default(now())
  source   String?

  @@index([userId])
  @@index([category])
  @@index([date])
}

model Challenge {
  id               String          @id @default(cuid())
  title            String
  description      String
  category         FootprintCategory
  durationDays     Int
  co2SavedKg       Float
  participantCount Int             @default(0)
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now())
  participants     UserChallenge[]
}

model UserChallenge {
  id          String    @id @default(cuid())
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  challenge   Challenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  challengeId String
  joinedAt    DateTime  @default(now())
  progress    Float     @default(0)
  completedAt DateTime?

  @@unique([userId, challengeId])
  @@index([userId])
  @@index([challengeId])
}

model ReductionTip {
  id                     String            @id @default(cuid())
  category               FootprintCategory
  title                  String
  description            String
  estimatedSavingKgPerYear Float
  difficulty             Difficulty
  upvotes                Int               @default(0)
  createdAt              DateTime          @default(now())
}

model MonthlyReport {
  id             String   @id @default(cuid())
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  month          Int
  year           Int
  totalCo2Kg     Float    @default(0)
  transportKg    Float    @default(0)
  foodKg         Float    @default(0)
  energyKg       Float    @default(0)
  shoppingKg     Float    @default(0)
  comparedToAvg  Float?

  @@unique([userId, month, year])
  @@index([userId])
}

model Achievement {
  id          String   @id @default(cuid())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  title       String
  description String
  icon        String?
  co2SavedKg  Float    @default(0)
  unlockedAt  DateTime @default(now())

  @@index([userId])
}

model CommunityBoard {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  post      String
  type      PostType
  likes     Int      @default(0)
  replies   Int      @default(0)
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([type])
}
